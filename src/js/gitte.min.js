!function(){const e=function(){const e=this;return e.data,e.subs=[],e.methods={publish:function(t){if(void 0===t)return e.data;e.data=t;for(let t=0,n=e.subs.length;t<n;++t)e.subs[t](e.data)},subscribe:function(t){-1===e.subs.indexOf(t)&&e.subs.push(t)},unsubscribe:function(t){-1!==e.subs.indexOf(t)&&e.subs.splice(e.subs.indexOf(t),1)}},e.methods},t={playingField:document.getElementById("field"),fieldBaseImage:document.getElementsByClassName("diaper-base")[0],fieldCoverImage:document.getElementsByClassName("diaper-cover")[0],mineImage:document.getElementsByClassName("mine")[0],flagImage:document.getElementsByClassName("flag")[0],levelSelection:document.getElementById("level-selection"),levelSelectButtons:document.querySelectorAll("[data-level]"),wonDialog:document.getElementById("won"),lostDialog:document.getElementById("lost"),newGameBtn:document.getElementsByClassName("new-game-btn")[0],saveGameBtn:document.getElementsByClassName("save-game-btn")[0],usernameInput:document.getElementById("name")},n={selectedLevel:new e,fieldSizeOptions:{easy:{x:8,y:8},medium:{x:10,y:10},expert:{x:16,y:16}},mineAmountOptions:{easy:10,medium:20,expert:40},field:[],mines:[],mineLocationOptions:[]},l={removeFlag:function(e,t){document.querySelector('[data-x="'+e+'"][data-y="'+t+'"] .flag').remove()},addFlag:function(e,n){const i=t.flagImage.cloneNode();i.addEventListener("click",(function(){l.removeFlag(e,n)}));document.querySelector('[data-x="'+e+'"][data-y="'+n+'"]').appendChild(i)},openDiaper:function(e,t){document.querySelector('[data-x="'+e+'"][data-y="'+t+'"] .diaper-cover').remove(),l.checkWin()},openDiaperChain:function(e,t){let l=[{x:e,y:t}];for(let e=0;e<l.length;e++){let t,i,a=l[e].x,d=l[e].y;document.querySelector('[data-x="'+a+'"][data-y="'+d+'"] .diaper-cover')&&document.querySelector('[data-x="'+a+'"][data-y="'+d+'"] .diaper-cover').remove(),t=d-1,i=a-1,t>=0&&i>=0&&document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover')&&(document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover').remove(),0===n.field[t][i].publish()&&l.push({x:i,y:t})),t=d-1,i=a,t>=0&&document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover')&&(document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover').remove(),0===n.field[t][i].publish()&&l.push({x:i,y:t})),t=d-1,i=a+1,t>=0&&i<n.field[0].length&&document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover')&&(document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover').remove(),0===n.field[t][i].publish()&&l.push({x:i,y:t})),t=d,i=a-1,i>=0&&document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover')&&(document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover').remove(),0===n.field[t][i].publish()&&l.push({x:i,y:t})),t=d,i=a+1,i<n.field[0].length&&document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover')&&(document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover').remove(),0===n.field[t][i].publish()&&l.push({x:i,y:t})),t=d+1,i=a-1,t<n.field.length&&i>=0&&document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover')&&(document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover').remove(),0===n.field[t][i].publish()&&l.push({x:i,y:t})),t=d+1,i=a,t<n.field.length&&document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover')&&(document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover').remove(),0===n.field[t][i].publish()&&l.push({x:i,y:t})),t=d+1,i=a+1,t<n.field.length&&i<n.field[0].length&&document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover')&&(document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover').remove(),0===n.field[t][i].publish()&&l.push({x:i,y:t}))}},checkWin:function(){document.querySelectorAll("#field .diaper-cover").length===n.mines.length&&l.gameWon()},gameWon:function(){t.saveGameBtn.addEventListener("click",(function(){console.log(t.usernameInput.value.trim())})),t.wonDialog.open=!0},gameLost:function(e,n){document.querySelector('[data-x="'+e+'"][data-y="'+n+'"] .diaper-cover').remove(),t.lostDialog.open=!0}},i={modelField:function(t){const l=n.fieldSizeOptions[t].y,i=n.fieldSizeOptions[t].x;n.field=new Array(l);for(let t=0;t<l;t++){n.field[t]=new Array(i);for(let l=0;l<i;l++)n.field[t][l]=new e,n.field[t][l].publish(0),n.mineLocationOptions.push({y:t,x:l})}},viewField:function(){const e=n.field.length,l=n.field[0].length;t.playingField.style.gridTemplateColumns="repeat("+e+", minmax(0, 1fr))",t.playingField.style.gridTemplateRows="repeat("+l+", minmax(0, 1fr))";for(let n=0;n<e;n++)for(let e=0;e<l;e++){const l=document.createElement("div"),i=t.fieldBaseImage.cloneNode(),a=document.createElement("p"),d=t.mineImage.cloneNode(),o=t.fieldCoverImage.cloneNode();l.className="relative w-full h-full",l.dataset.x=""+e,l.dataset.y=""+n,a.className="absolute inset-0 pointer-events-none flex justify-center items-center text-[min(3.5vw,_37px)]",l.appendChild(i),l.appendChild(a),l.appendChild(d),l.appendChild(o),t.playingField.appendChild(l)}},modelMines:function(e){const t=n.mineAmountOptions[e],l=n.fieldSizeOptions[e].y*n.fieldSizeOptions[e].x;for(let e=0;e<t;e++){const e=Math.floor(Math.random()*l),t=n.mineLocationOptions.splice(e,1);n.mines.push(...t)}for(let e=0,t=n.mines.length;e<t;e++){const t=n.mines[e];n.field[t.y][t.x].publish("mine")}},modelFieldValues:function(e){for(let t=0,l=e.length;t<l;t++){let l,i,a=e[t].x,d=e[t].y;i=d-1,l=a-1,i>=0&&l>=0&&"mine"!==n.field[i][l].publish()&&n.field[i][l].publish(n.field[i][l].publish()+1),i=d-1,l=a,i>=0&&"mine"!==n.field[i][l].publish()&&n.field[i][l].publish(n.field[i][l].publish()+1),i=d-1,l=a+1,i>=0&&l<n.field[0].length&&"mine"!==n.field[i][l].publish()&&n.field[i][l].publish(n.field[i][l].publish()+1),i=d,l=a-1,l>=0&&"mine"!==n.field[i][l].publish()&&n.field[i][l].publish(n.field[i][l].publish()+1),i=d,l=a+1,l<n.field[0].length&&"mine"!==n.field[i][l].publish()&&n.field[i][l].publish(n.field[i][l].publish()+1),i=d+1,l=a-1,i<n.field.length&&l>=0&&"mine"!==n.field[i][l].publish()&&n.field[i][l].publish(n.field[i][l].publish()+1),i=d+1,l=a,i<n.field.length&&"mine"!==n.field[i][l].publish()&&n.field[i][l].publish(n.field[i][l].publish()+1),i=d+1,l=a+1,i<n.field.length&&l<n.field[0].length&&"mine"!==n.field[i][l].publish()&&n.field[i][l].publish(n.field[i][l].publish()+1)}},viewFields:function(e){const t=e.length,n=e[0].length;for(let l=0;l<t;l++)for(let t=0;t<n;t++)"mine"===e[l][t].publish()&&document.querySelector('[data-x="'+t+'"][data-y="'+l+'"] .mine').classList.remove("hidden"),e[l][t].publish()>0&&(document.querySelector('[data-x="'+t+'"][data-y="'+l+'"] p').innerHTML=e[l][t].publish())},listeners:function(){[...document.querySelectorAll("#field .diaper-cover")].forEach((e=>{let i;e.addEventListener("click",(function(){const t=parseInt(e.parentElement.dataset.x),i=parseInt(e.parentElement.dataset.y);switch(n.field[i][t].publish()){case"mine":l.gameLost(t,i);break;case 0:l.openDiaperChain(t,i);break;default:l.openDiaper(t,i)}})),e.addEventListener("contextmenu",(function(t){t.preventDefault();const n=parseInt(e.parentElement.dataset.x),i=parseInt(e.parentElement.dataset.y);l.addFlag(n,i)})),e.addEventListener("touchstart",(function(t){t.preventDefault(),i=setTimeout((function(){const t=parseInt(e.parentElement.dataset.x),n=parseInt(e.parentElement.dataset.y);l.addFlag(t,n)}),500)})),e.addEventListener("touchend",(function(t){if(t.preventDefault(),i)clearTimeout(i);else{const t=parseInt(e.parentElement.dataset.x),n=parseInt(e.parentElement.dataset.y);l.openDiaper(t,n)}})),t.newGameBtn.addEventListener("click",(function(){window.location.reload()}))}))},init:function(){n.selectedLevel.subscribe((function(e){t.levelSelection.classList.add("hidden","sm:hidden"),t.playingField.classList.remove("hidden"),t.playingField.classList.add("grid"),i.modelField(e),i.viewField(),i.modelMines(e),i.modelFieldValues(n.mines),i.viewFields(n.field),i.listeners()})),[...t.levelSelectButtons].forEach((e=>{e.addEventListener("click",(function(){n.selectedLevel.publish(e.dataset.level)}))}))}};i.init()}();