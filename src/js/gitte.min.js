!function(){const e=function(){const e=this;return e.data,e.subs=[],e.methods={publish:function(t){if(void 0===t)return e.data;e.data=t;for(let t=0,l=e.subs.length;t<l;++t)e.subs[t](e.data)},subscribe:function(t){-1===e.subs.indexOf(t)&&e.subs.push(t)},unsubscribe:function(t){-1!==e.subs.indexOf(t)&&e.subs.splice(e.subs.indexOf(t),1)}},e.methods},t={playingField:document.getElementById("field"),fieldBaseImage:document.getElementsByClassName("diaper-base")[0],fieldCoverImage:document.getElementsByClassName("diaper-cover")[0],mineImage:document.getElementsByClassName("mine")[0],flagImage:document.getElementsByClassName("flag")[0],levelSelection:document.getElementById("level-selection"),levelSelectButtons:document.querySelectorAll("[data-level]"),wonDialog:document.getElementById("won"),lostDialog:document.getElementById("lost")},l={selectedLevel:new e,fieldSizeOptions:{easy:{x:8,y:8},medium:{x:10,y:10},expert:{x:16,y:16}},mineAmountOptions:{easy:10,medium:20,expert:40},field:[],mines:[],mineLocationOptions:[]},i={removeFlag:function(e,t){document.querySelector('[data-x="'+e+'"][data-y="'+t+'"] .flag').remove()},addFlag:function(e,l){const d=t.flagImage.cloneNode();d.addEventListener("click",(function(){i.removeFlag(e,l)}));document.querySelector('[data-x="'+e+'"][data-y="'+l+'"]').appendChild(d)},openDiaper:function(e,t){document.querySelector('[data-x="'+e+'"][data-y="'+t+'"] .diaper-cover').remove(),i.checkWin()},openDiaperChain:function(e,t){let i=[{x:e,y:t}];for(let e=0;e<i.length;e++){let t,d,n=i[e].x,a=i[e].y;document.querySelector('[data-x="'+n+'"][data-y="'+a+'"] .diaper-cover')&&document.querySelector('[data-x="'+n+'"][data-y="'+a+'"] .diaper-cover').remove(),t=a-1,d=n-1,t>=0&&d>=0&&document.querySelector('[data-x="'+d+'"][data-y="'+t+'"] .diaper-cover')&&(document.querySelector('[data-x="'+d+'"][data-y="'+t+'"] .diaper-cover').remove(),0===l.field[t][d].publish()&&i.push({x:d,y:t})),t=a-1,d=n,t>=0&&document.querySelector('[data-x="'+d+'"][data-y="'+t+'"] .diaper-cover')&&(document.querySelector('[data-x="'+d+'"][data-y="'+t+'"] .diaper-cover').remove(),0===l.field[t][d].publish()&&i.push({x:d,y:t})),t=a-1,d=n+1,t>=0&&d<l.field[0].length&&document.querySelector('[data-x="'+d+'"][data-y="'+t+'"] .diaper-cover')&&(document.querySelector('[data-x="'+d+'"][data-y="'+t+'"] .diaper-cover').remove(),0===l.field[t][d].publish()&&i.push({x:d,y:t})),t=a,d=n-1,d>=0&&document.querySelector('[data-x="'+d+'"][data-y="'+t+'"] .diaper-cover')&&(document.querySelector('[data-x="'+d+'"][data-y="'+t+'"] .diaper-cover').remove(),0===l.field[t][d].publish()&&i.push({x:d,y:t})),t=a,d=n+1,d<l.field[0].length&&document.querySelector('[data-x="'+d+'"][data-y="'+t+'"] .diaper-cover')&&(document.querySelector('[data-x="'+d+'"][data-y="'+t+'"] .diaper-cover').remove(),0===l.field[t][d].publish()&&i.push({x:d,y:t})),t=a+1,d=n-1,t<l.field.length&&d>=0&&document.querySelector('[data-x="'+d+'"][data-y="'+t+'"] .diaper-cover')&&(document.querySelector('[data-x="'+d+'"][data-y="'+t+'"] .diaper-cover').remove(),0===l.field[t][d].publish()&&i.push({x:d,y:t})),t=a+1,d=n,t<l.field.length&&document.querySelector('[data-x="'+d+'"][data-y="'+t+'"] .diaper-cover')&&(document.querySelector('[data-x="'+d+'"][data-y="'+t+'"] .diaper-cover').remove(),0===l.field[t][d].publish()&&i.push({x:d,y:t})),t=a+1,d=n+1,t<l.field.length&&d<l.field[0].length&&document.querySelector('[data-x="'+d+'"][data-y="'+t+'"] .diaper-cover')&&(document.querySelector('[data-x="'+d+'"][data-y="'+t+'"] .diaper-cover').remove(),0===l.field[t][d].publish()&&i.push({x:d,y:t}))}},checkWin:function(){document.querySelectorAll("#field .diaper-cover").length===l.mines.length&&i.gameWon()},gameWon:function(){t.wonDialog.open=!0},gameLost:function(e,l){document.querySelector('[data-x="'+e+'"][data-y="'+l+'"] .diaper-cover').remove(),t.lostDialog.open=!0}},d={modelField:function(t){const i=l.fieldSizeOptions[t].y,d=l.fieldSizeOptions[t].x;l.field=new Array(i);for(let t=0;t<i;t++){l.field[t]=new Array(d);for(let i=0;i<d;i++)l.field[t][i]=new e,l.field[t][i].publish(0),l.mineLocationOptions.push({y:t,x:i})}},viewField:function(){const e=l.field.length,i=l.field[0].length;t.playingField.style.gridTemplateColumns="repeat("+e+", minmax(0, 1fr))",t.playingField.style.gridTemplateRows="repeat("+i+", minmax(0, 1fr))";for(let l=0;l<e;l++)for(let e=0;e<i;e++){const i=document.createElement("div"),d=t.fieldBaseImage.cloneNode(),n=document.createElement("p"),a=t.mineImage.cloneNode(),o=t.fieldCoverImage.cloneNode();i.className="relative w-full h-full",i.dataset.x=""+e,i.dataset.y=""+l,n.className="absolute inset-0 pointer-events-none flex justify-center items-center text-[min(3.5vw,_37px)]",i.appendChild(d),i.appendChild(n),i.appendChild(a),i.appendChild(o),t.playingField.appendChild(i)}},modelMines:function(e){const t=l.mineAmountOptions[e],i=l.fieldSizeOptions[e].y*l.fieldSizeOptions[e].x;for(let e=0;e<t;e++){const e=Math.floor(Math.random()*i),t=l.mineLocationOptions.splice(e,1);l.mines.push(...t)}for(let e=0,t=l.mines.length;e<t;e++){const t=l.mines[e];l.field[t.y][t.x].publish("mine")}},modelFieldValues:function(e){for(let t=0,i=e.length;t<i;t++){let i,d,n=e[t].x,a=e[t].y;d=a-1,i=n-1,d>=0&&i>=0&&"mine"!==l.field[d][i].publish()&&l.field[d][i].publish(l.field[d][i].publish()+1),d=a-1,i=n,d>=0&&"mine"!==l.field[d][i].publish()&&l.field[d][i].publish(l.field[d][i].publish()+1),d=a-1,i=n+1,d>=0&&i<l.field[0].length&&"mine"!==l.field[d][i].publish()&&l.field[d][i].publish(l.field[d][i].publish()+1),d=a,i=n-1,i>=0&&"mine"!==l.field[d][i].publish()&&l.field[d][i].publish(l.field[d][i].publish()+1),d=a,i=n+1,i<l.field[0].length&&"mine"!==l.field[d][i].publish()&&l.field[d][i].publish(l.field[d][i].publish()+1),d=a+1,i=n-1,d<l.field.length&&i>=0&&"mine"!==l.field[d][i].publish()&&l.field[d][i].publish(l.field[d][i].publish()+1),d=a+1,i=n,d<l.field.length&&"mine"!==l.field[d][i].publish()&&l.field[d][i].publish(l.field[d][i].publish()+1),d=a+1,i=n+1,d<l.field.length&&i<l.field[0].length&&"mine"!==l.field[d][i].publish()&&l.field[d][i].publish(l.field[d][i].publish()+1)}},viewFields:function(e){const t=e.length,l=e[0].length;for(let i=0;i<t;i++)for(let t=0;t<l;t++)"mine"===e[i][t].publish()&&document.querySelector('[data-x="'+t+'"][data-y="'+i+'"] .mine').classList.remove("hidden"),e[i][t].publish()>0&&(document.querySelector('[data-x="'+t+'"][data-y="'+i+'"] p').innerHTML=e[i][t].publish())},listeners:function(){[...document.querySelectorAll("#field .diaper-cover")].forEach((e=>{e.addEventListener("click",(function(){const t=parseInt(e.parentElement.dataset.x),d=parseInt(e.parentElement.dataset.y);switch(l.field[d][t].publish()){case"mine":i.gameLost(t,d);break;case 0:i.openDiaperChain(t,d);break;default:i.openDiaper(t,d)}})),e.addEventListener("contextmenu",(function(t){t.preventDefault();const l=parseInt(e.parentElement.dataset.x),d=parseInt(e.parentElement.dataset.y);i.addFlag(l,d)}))}))},init:function(){l.selectedLevel.subscribe((function(e){t.levelSelection.classList.add("hidden","sm:hidden"),t.playingField.classList.remove("hidden"),t.playingField.classList.add("grid"),d.modelField(e),d.viewField(),d.modelMines(e),d.modelFieldValues(l.mines),d.viewFields(l.field),d.listeners()})),[...t.levelSelectButtons].forEach((e=>{e.addEventListener("click",(function(){l.selectedLevel.publish(e.dataset.level)}))}))}};d.init()}();