!function(){const e=function(){const e=this;return e.data,e.subs=[],e.methods={publish:function(t){if(void 0===t)return e.data;e.data=t;for(let t=0,l=e.subs.length;t<l;++t)e.subs[t](e.data)},subscribe:function(t){-1===e.subs.indexOf(t)&&e.subs.push(t)},unsubscribe:function(t){-1!==e.subs.indexOf(t)&&e.subs.splice(e.subs.indexOf(t),1)}},e.methods},t={playingField:document.getElementById("field"),fieldBaseImage:document.getElementsByClassName("diaper-base")[0],fieldCoverImage:document.getElementsByClassName("diaper-cover")[0],mineImage:document.getElementsByClassName("mine")[0],flagImage:document.getElementsByClassName("flag")[0],levelSelection:document.getElementById("level-selection"),levelSelectButtons:document.querySelectorAll("[data-level]"),wonDialog:document.getElementById("won"),lostDialog:document.getElementById("lost"),newGameBtns:document.getElementsByClassName("new-game-btn"),saveGameBtn:document.getElementsByClassName("save-game-btn")[0],usernameInput:document.getElementById("name")},l={selectedLevel:new e,fieldSizeOptions:{easy:{x:8,y:8},medium:{x:10,y:10},expert:{x:16,y:16}},mineAmountOptions:{easy:10,medium:20,expert:40},field:[],mines:[],mineLocationOptions:[]},n={removeFlag:function(e,t){document.querySelector('[data-x="'+e+'"][data-y="'+t+'"] .flag').remove()},addFlag:function(e,l){const i=t.flagImage.cloneNode();i.addEventListener("click",(function(){n.removeFlag(e,l)}));document.querySelector('[data-x="'+e+'"][data-y="'+l+'"]').appendChild(i)},openDiaper:function(e,t){document.querySelector('[data-x="'+e+'"][data-y="'+t+'"] .diaper-cover').remove(),n.checkWin()},openDiaperChain:function(e,t){let n=[{x:e,y:t}];for(let e=0;e<n.length;e++){let t,i,a=n[e].x,d=n[e].y;document.querySelector('[data-x="'+a+'"][data-y="'+d+'"] .diaper-cover')&&document.querySelector('[data-x="'+a+'"][data-y="'+d+'"] .diaper-cover').remove(),t=d-1,i=a-1,t>=0&&i>=0&&document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover')&&(document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover').remove(),0===l.field[t][i].publish()&&n.push({x:i,y:t})),t=d-1,i=a,t>=0&&document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover')&&(document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover').remove(),0===l.field[t][i].publish()&&n.push({x:i,y:t})),t=d-1,i=a+1,t>=0&&i<l.field[0].length&&document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover')&&(document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover').remove(),0===l.field[t][i].publish()&&n.push({x:i,y:t})),t=d,i=a-1,i>=0&&document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover')&&(document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover').remove(),0===l.field[t][i].publish()&&n.push({x:i,y:t})),t=d,i=a+1,i<l.field[0].length&&document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover')&&(document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover').remove(),0===l.field[t][i].publish()&&n.push({x:i,y:t})),t=d+1,i=a-1,t<l.field.length&&i>=0&&document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover')&&(document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover').remove(),0===l.field[t][i].publish()&&n.push({x:i,y:t})),t=d+1,i=a,t<l.field.length&&document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover')&&(document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover').remove(),0===l.field[t][i].publish()&&n.push({x:i,y:t})),t=d+1,i=a+1,t<l.field.length&&i<l.field[0].length&&document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover')&&(document.querySelector('[data-x="'+i+'"][data-y="'+t+'"] .diaper-cover').remove(),0===l.field[t][i].publish()&&n.push({x:i,y:t}))}},checkWin:function(){document.querySelectorAll("#field .diaper-cover").length===l.mines.length&&n.gameWon()},gameWon:function(){t.saveGameBtn.addEventListener("click",(function(){console.log(t.usernameInput.value.trim())})),t.wonDialog.open=!0},gameLost:function(e,l){document.querySelector('[data-x="'+e+'"][data-y="'+l+'"] .diaper-cover').remove(),t.lostDialog.open=!0}},i={modelField:function(t){const n=l.fieldSizeOptions[t].y,i=l.fieldSizeOptions[t].x;l.field=new Array(n);for(let t=0;t<n;t++){l.field[t]=new Array(i);for(let n=0;n<i;n++)l.field[t][n]=new e,l.field[t][n].publish(0),l.mineLocationOptions.push({y:t,x:n})}},viewField:function(){const e=l.field.length,n=l.field[0].length;t.playingField.style.gridTemplateColumns="repeat("+e+", minmax(0, 1fr))",t.playingField.style.gridTemplateRows="repeat("+n+", minmax(0, 1fr))";for(let l=0;l<e;l++)for(let e=0;e<n;e++){const n=document.createElement("div"),i=t.fieldBaseImage.cloneNode(),a=document.createElement("p"),d=t.mineImage.cloneNode(),o=t.fieldCoverImage.cloneNode();n.className="relative w-full h-full",n.dataset.x=""+e,n.dataset.y=""+l,a.className="absolute inset-0 pointer-events-none flex justify-center items-center text-[min(3.5vw,_37px)]",n.appendChild(i),n.appendChild(a),n.appendChild(d),n.appendChild(o),t.playingField.appendChild(n)}},modelMines:function(e){const t=l.mineAmountOptions[e],n=l.fieldSizeOptions[e].y*l.fieldSizeOptions[e].x;for(let e=0;e<t;e++){const e=Math.floor(Math.random()*n),t=l.mineLocationOptions.splice(e,1);l.mines.push(...t)}for(let e=0,t=l.mines.length;e<t;e++){const t=l.mines[e];l.field[t.y][t.x].publish("mine")}},modelFieldValues:function(e){for(let t=0,n=e.length;t<n;t++){let n,i,a=e[t].x,d=e[t].y;i=d-1,n=a-1,i>=0&&n>=0&&"mine"!==l.field[i][n].publish()&&l.field[i][n].publish(l.field[i][n].publish()+1),i=d-1,n=a,i>=0&&"mine"!==l.field[i][n].publish()&&l.field[i][n].publish(l.field[i][n].publish()+1),i=d-1,n=a+1,i>=0&&n<l.field[0].length&&"mine"!==l.field[i][n].publish()&&l.field[i][n].publish(l.field[i][n].publish()+1),i=d,n=a-1,n>=0&&"mine"!==l.field[i][n].publish()&&l.field[i][n].publish(l.field[i][n].publish()+1),i=d,n=a+1,n<l.field[0].length&&"mine"!==l.field[i][n].publish()&&l.field[i][n].publish(l.field[i][n].publish()+1),i=d+1,n=a-1,i<l.field.length&&n>=0&&"mine"!==l.field[i][n].publish()&&l.field[i][n].publish(l.field[i][n].publish()+1),i=d+1,n=a,i<l.field.length&&"mine"!==l.field[i][n].publish()&&l.field[i][n].publish(l.field[i][n].publish()+1),i=d+1,n=a+1,i<l.field.length&&n<l.field[0].length&&"mine"!==l.field[i][n].publish()&&l.field[i][n].publish(l.field[i][n].publish()+1)}},viewFields:function(e){const t=e.length,l=e[0].length;for(let n=0;n<t;n++)for(let t=0;t<l;t++)"mine"===e[n][t].publish()&&document.querySelector('[data-x="'+t+'"][data-y="'+n+'"] .mine').classList.remove("hidden"),e[n][t].publish()>0&&(document.querySelector('[data-x="'+t+'"][data-y="'+n+'"] p').innerHTML=e[n][t].publish())},listeners:function(){[...document.querySelectorAll("#field .diaper-cover")].forEach((e=>{let i;e.addEventListener("click",(function(){const t=parseInt(e.parentElement.dataset.x),i=parseInt(e.parentElement.dataset.y);switch(l.field[i][t].publish()){case"mine":n.gameLost(t,i);break;case 0:n.openDiaperChain(t,i);break;default:n.openDiaper(t,i)}})),e.addEventListener("contextmenu",(function(t){t.preventDefault();const l=parseInt(e.parentElement.dataset.x),i=parseInt(e.parentElement.dataset.y);n.addFlag(l,i)})),e.addEventListener("touchstart",(function(e){e.preventDefault(),i=Date.now()})),e.addEventListener("touchend",(function(t){t.preventDefault();const a=parseInt(e.parentElement.dataset.x),d=parseInt(e.parentElement.dataset.y);if(Date.now()-i>500)n.addFlag(a,d);else switch(l.field[d][a].publish()){case"mine":n.gameLost(a,d);break;case 0:n.openDiaperChain(a,d);break;default:n.openDiaper(a,d)}})),[...t.newGameBtns].forEach((function(e){e.addEventListener("click",(function(){window.location.reload()}))}))}))},init:function(){l.selectedLevel.subscribe((function(e){t.levelSelection.classList.add("hidden","sm:hidden"),t.playingField.classList.remove("hidden"),t.playingField.classList.add("grid"),i.modelField(e),i.viewField(),i.modelMines(e),i.modelFieldValues(l.mines),i.viewFields(l.field),i.listeners()})),[...t.levelSelectButtons].forEach((e=>{e.addEventListener("click",(function(t){t.preventDefault(),l.selectedLevel.publish(e.dataset.level)}))}))}};i.init()}();